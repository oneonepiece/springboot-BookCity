<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html xmlns:th="http://www.w3.org/1999/xhtml">
<header th:replace="admin/header::header-fragment"></header>
<style>
    .span-my-19921{
        padding: 12px 12px;
        font-size: 0.875rem;
        font-weight: 400;
        line-height: 1;
        color: #555;
        text-align: center;
        background-color: #eee;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 90px;
    }
</style>

<link rel="stylesheet" th:href="@{/admin/plugins/bootstrap/fileinput/fileinput.min.css}"/>


<body class="hold-transition sidebar-mini">
<div class="wrapper">
    <!-- 引入页面头header-fragment -->
    <div th:replace="admin/header::header-nav"></div>
    <!-- 引入工具栏sidebar-fragment -->
    <div th:replace="admin/sidebar::sidebar-fragment(${path})"></div>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
            </div><!-- /.container-fluid -->
        </div>
        <!-- Main content -->
        <div class="content">
            <div class="container-fluid">
                <div class="card-header">
                    <h3 class="card-title">图书管理</h3>
                </div> <!-- /.card-body -->
                <div class="row " style="margin-top: 40px;border-top:0px;padding: 0.75rem 1.25rem;">
                    <!--<div class="col-md-2 "  ></div>-->
                    <div class="col-md-8 "  >


                        <button  id="add-book" type="button" class="btn btn-primary btn-sm active" >添加图书</button>
                        <!--<button  id="book_list" type="button" class="btn btn-primary btn-sm active">图书列表</button>-->

                        <div class="input-group " style="margin-top:20px;">
                            <span class="input-group-addon span-my-19921"  >书名:</span>
                            <input type="text" class="form-control" placeholder="输入书名" id="m_b_name">
                        </div>

                        <div class="input-group " style="margin-top:20px;">
                            <span class="input-group-addon span-my-19921"    >封面</span>
                            <!--<input type="text" class="form-control" placeholder="">-->
                            <!-- 就是一个简单的文件表单字段 -->
                            <!--<label class="control-label" for="testfile">上传文件</label>-->
                        </div>
                        <input type="file" id="testfile" class="m_img_url" name="test" multiple  />
                        <!--<div class="input-group " style="margin-top:20px;margin-left: -7px;">-->
                            <!--<span class="input-group-addon span-my-19921"   id="" >小图:</span>-->
                            <!--<input type="text" class="form-control" placeholder="">-->
                        <!--</div>-->
                        <div class="col-md-4 "  >


                            <div class="input-group " style="margin-top:20px;margin-left: -7px;">
                                <span class="input-group-addon span-my-19921"   >定价:</span>
                                <input type="text" class="form-control" placeholder="举例:0.0" id="m_book_price">
                            </div>
                            <div class="input-group " style="margin-top:20px;margin-left: -7px;">
                                <span class="input-group-addon span-my-19921"    >折扣:</span>
                                <input type="text" class="form-control" placeholder="举例:1.0" id="m_book_discount">
                            </div>
                            <div class="input-group " style="margin-top:20px;margin-left: -7px;">
                                <span class="input-group-addon span-my-19921"   >当前价格:</span>
                                <input type="text" class="form-control" placeholder="举例:0.0" id="m_book_curr_price">
                            </div>

                        </div>

                        <div class="input-group " style="margin-top:20px;">
                            <span class="input-group-addon span-my-19921"   >作者:</span>
                            <input type="text" class="form-control" id="m_book_author">
                            <span class="input-group-addon span-my-19921"   >出版社:</span>
                            <input type="text" class="form-control" id="m_book_press">

                        </div>
                        <div class="input-group " style="margin-top:20px;">
                            <span class="input-group-addon span-my-19921"   >出版时间:</span>
                            <input type="text" class="form-control" placeholder="举例:2000-01-01" id="m_book_publish_time">
                            <span class="input-group-addon span-my-19921"   >印刷时间:</span>
                            <input type="text" class="form-control" placeholder="举例:2000-01-01" id="m_book_print_time">
                        </div>
                        <div class="input-group " style="margin-top:20px;">
                            <span class="input-group-addon span-my-19921"   >版次:</span>
                            <input type="text" class="form-control" placeholder="" id="m_book_edition">
                            <span class="input-group-addon span-my-19921"   >开本:</span>
                            <input type="text" class="form-control" placeholder="举例:16开" id="m_book_book_size">
                            <span class="input-group-addon span-my-19921"   >纸张:</span>
                            <input type="text" class="form-control" placeholder="举例:胶版印刷纸" id="m_book_paper">
                        </div>
                        <div class="input-group " style="margin-top:20px;">
                            <span class="input-group-addon span-my-19921"   >页数:</span>
                            <input type="text" class="form-control" placeholder="00" id="m_book_page_num">
                            <span class="input-group-addon span-my-19921"   >字数:</span>
                            <input type="text" class="form-control" placeholder="000" id="m_book_word_num">
                        </div>

                        <div class="input-group " style="margin-top:20px;">
                            <span class="input-group-addon span-my-19921"   id="">一级分类:</span>
                            <input type="text" class="form-control" placeholder="">
                            <span class="input-group-addon span-my-19921"   id="">二级分类:</span>
                            <input type="text" class="form-control" placeholder="">
                        </div>

                    </div>

                </div>
            </div><!-- /.container-fluid -->
        </div>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->


    <!-- 引入页脚footer-fragment -->
    <div th:replace="admin/footer::footer-fragment"></div>
</div>
<!-- jQuery -->
<script th:src="@{/admin/plugins/jquery/jquery.min.js}"></script>
<!-- jQuery UI 1.11.4 -->
<script th:src="@{/admin/plugins/jQueryUI/jquery-ui.min.js}"></script>
<!-- Bootstrap 4 -->
<script th:src="@{/admin/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
<!-- AdminLTE App -->
<script th:src="@{/admin/dist/js/adminlte.min.js}"></script>

<!--文件上传js-->
<script th:src="@{/admin/plugins/bootstrap/fileinput/fileinput.min.js}"></script>
<script th:src="@{/admin/plugins/bootstrap/fileinput/zh.js}"></script>


         <!--<link href="~/Content/Tree1/css/style.css" rel="stylesheet" />-->
<script type="text/javascript">

    //Book
    var m_book_Name = "";
    var m_book_price = "";
    var m_book_discount = "";
    var m_book_curr_price = "";
    var m_book_author = "";
    var m_book_press = "";
    var m_book_publish_time = "";
    var m_book_print_time = "";
    var m_book_edition = "";
    var m_book_book_size = "";
    var m_book_paper = "";
    var m_book_page_num = "";
    var m_book_word_num = "";


    //取值,  此处需要做校验
    getValues = function () {
        m_book_Name = $('#m_b_name').val().toString();
        m_book_price = $('#m_book_price').val().toString();
        m_book_discount = $('#m_book_discount').val().toString();
        m_book_curr_price = $('#m_book_curr_price').val().toString();
        m_book_author = $('#m_book_author').val().toString();
        m_book_press = $('#m_book_press').val().toString();
        m_book_publish_time = $('#m_book_publish_time').val().toString();
        m_book_print_time = $('#m_book_print_time').val().toString();
        m_book_edition = $('#m_book_edition').val().toString();
        m_book_book_size = $('#m_book_book_size').val().toString();
        m_book_paper = $('#m_book_paper').val().toString();
        m_book_page_num = $('#m_book_page_num').val().toString();
        m_book_word_num = $('#m_book_word_num').val().toString();

    }

    //转成json
    getJsonData = function () {
            return JSON.stringify({
                bookName : m_book_Name.toString() , //书名
                bookPrice : m_book_price.toString() , //单价
                bookDiscount : m_book_discount , //折扣
                bookCurrPrice : m_book_curr_price , // 当前价格
                bookAuthor : m_book_author , //作者
                bookPress : m_book_press , //
                bookPublishTime : m_book_publish_time ,
                bookPrintTime : m_book_print_time ,
                bookEdition : m_book_edition ,
                bookSize : m_book_book_size ,
                bookPaper : m_book_paper ,
                bookPageNum : m_book_page_num ,
                bookWordNum : m_book_word_num });
    }

    //前端数据校验 ,验证通过true  ,失败 false
    dataValidation = function(){

        if (m_book_Name == ""){

            return false;
        }
        if (m_book_price == ""){

            return false;
        }
        if (m_book_discount == ""){

            return false;
        }
        if (m_book_curr_price == ""){

            return false;
        }
        if (m_book_author == ""){
            return false;
        }
        if (m_book_press == ""){
            return false;
        }
        if (m_book_publish_time == ""){
            return false;
        }
        if (m_book_print_time == ""){
            return false;
        }
        if (m_book_edition == ""){
            return false;
        }
        if (m_book_book_size == ""){
            return false;
        }
        if (m_book_paper == ""){
            return false;
        }
        if (m_book_page_num == ""){
            return false;
        }
        if (m_book_word_num == ""){
            return false;
        }
        return true;
    }

    //文档加载完执行
    $(document).ready(function(){

        //添加按钮实现
        $('#add-book').click(function () {
                // getValues();
            //点击上传按钮
            $('.fileinput-upload-button').click();
        });

        // $('#book_list').click(function () {
        //
        //     location.href = "/admin/booklist";
        // });

        //bootstrap 的fileinput 插件
        // 参考教程 https://www.cnblogs.com/parker-yu/p/7207071.html
        //http://www.bootstrap-fileinput.com/events.html
        $('#testfile').fileinput({
            language: 'zh',
            uploadUrl: location.pathname + '/upload',
            showCaption: true, //显示标题
            uploadAsync : true, //异步上传
            showUpload: true, //显示上传按钮
            showRemove: true, //显示删除按钮
            showClose: true, //显示关闭按钮
            autoReplace:1, //自动替换
            maxFileCount:1, //最大上传文件数为1
            browseClass: 'btn btn-primary',
            uploadExtraData: function(previewId, index) {  //上传额外数据
                return { BookJsonData :getJsonData()};
            }
        });

        //点击上传前做好数据的赋值,在filepreupload  和 uploadExtraData 之前被执行
        $('#testfile').on('filelock', function(event, filestack, extraData) {
            getValues();//取值
        });

        //在uploadExtraData  之后才会执行
        $('#testfile').on('filepreupload', function(event, data, previewId, index, jqXHR) {

            data.extra = getJsonData();  //再次转成从value 到 json

            ValidationFailedMessage = {
                message: '验证没通过',
                data : {}
                // data: {key1: 'Key 1', detail1: 'Detail 1'}
            }

            // 进行自定义验证并返回如下所示的错误
            if (!dataValidation()) {
                return ValidationFailedMessage;
            }
        });

        //上传成功时
        $('#testfile').on('fileuploaded', function(event, data, previewId, index) {
            var response = data.response;
            $('#m_b_name').val("");
            $('#m_book_price').val("");
            $('#m_book_discount').val("");
            $('#m_book_curr_price').val("");
            $('#m_book_author').val("");
            $('#m_book_press').val("");
            $('#m_book_publish_time').val("");
            $('#m_book_print_time').val("");
            $('#m_book_edition').val("");
            $('#m_book_book_size').val("");
            $('#m_book_paper').val("");
            $('#m_book_page_num').val("");
            $('#m_book_word_num').val("");

            console.log('上传成功');
        });

        //上传失败
        $('#input-id').on('fileuploaderror', function(event, data, msg) {
            var form = data.form, files = data.files, extra = data.extra,
                response = data.response, reader = data.reader;
            console.log('File upload error');
            // 获取信息
            alert(msg);
        });

        //测试数据
        $('#m_b_name').val("bookName");
        $('#m_book_price').val("18.5");
        $('#m_book_discount').val("8.1");
        $('#m_book_curr_price').val("20.2");
        $('#m_book_author').val("author");
        $('#m_book_press').val("出版社");
        $('#m_book_publish_time').val("2001-01-01");
        $('#m_book_print_time').val("2003-01-01");
        $('#m_book_edition').val("6");
        $('#m_book_book_size').val("16");
        $('#m_book_paper').val("胶纸");
        $('#m_book_page_num').val("256");
        $('#m_book_word_num').val("1024");

    });

</script>

</body>
</html>
