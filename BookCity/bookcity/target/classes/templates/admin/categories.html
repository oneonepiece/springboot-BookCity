<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html xmlns:th="http://www.w3.org/1999/xhtml">
<header th:replace="admin/header::header-fragment"></header>
<body class="hold-transition sidebar-mini">
<div class="wrapper">
    <!-- 引入页面头header-fragment -->
    <div th:replace="admin/header::header-nav"></div>
    <!-- 引入工具栏sidebar-fragment -->
    <div th:replace="admin/sidebar::sidebar-fragment(${path})"></div>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
            </div><!-- /.container-fluid -->
        </div>
        <!-- Main content -->
        <div class="content">
            <div class="container-fluid">
                <div class="card-header">
                    <h3 class="card-title">分类管理</h3>
                </div> <!-- /.card-body -->
                <div class="row" style="margin-top: 40px;border-top:0px;">
                    <!--<div class="col-md-2 "  ></div>-->
                    <div class="col-md-12"  >


                        <th:block th:if="${ null != categorys }">
                        <table class="table ">
                            <thead>
                            <tr >
                                <th>#</th>
                                <th>分类名称</th>
                                <th>描述</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody>

                            <tr >
                                <th scope="row">

                                </th>
                                <td>

                                </td>
                                <td>
                                    <!--<a href="#" class="add-ca">添加一级分类</a>-->
                                    <button type="button" class="btn btn-success" id="add-ca">添加一级分类</button>
                                </td>
                                <td>

                                </td>
                            </tr>

                            <th:block th:each="category,categoryStat : ${categorys}">
                            <tr style="background: #fcf8e3;">
                                <th scope="row">

                                    <th:block th:text="${categoryStat.count}"></th:block>
                                </th>
                                <td>
                                    <th:block th:text="${category.category_name}"></th:block>
                                </td>
                                <td>
                                    <th:block th:text="${category.category_name}"></th:block>相关
                                </td>
                                <td>
                                    <!--<a href="#" th:id="'add-cl' + ${category.category_id}" class="cl-add">添加二级分类</a>-->
                                    <button type="button" class="btn btn-primary " th:id="'add012-cl' + ${category.category_id}">添加二级分类</button>
                                    <button type="button" class="btn btn-primary " th:id="'updata-ca' + ${category.category_id}">修改</button>
                                    <button type="button" class="btn btn-primary " th:id="'remove-ca' + ${category.category_id}">删除</button>
                                    <!--<a href="#" th:id="'updata-ca' + ${category.category_id}" class="ca-updata">修改</a>-->
                                    <!--<a href="#" th:id="'remove-ca' + ${category.category_id}" class="ca-remove">删除</a>-->
                                </td>
                            </tr>

                                <th:block th:if="${ null != category.classifies }">
                                    <th:block th:each="classifie : ${category.classifies}">
                                        <tr >
                                            <th scope="row"></th>
                                            <td>
                                                <th:block th:text="${classifie.classify_name}"></th:block>
                                            </td>
                                            <td>
                                                <th:block th:text="${classifie.classify_name}"></th:block>相关</td>
                                            <td>
                                                <button type="button" class="btn btn-default " th:id="'updata-cl' + ${classifie.classify_id}">修改</button>
                                                <button type="button" class="btn btn-default " th:id="'remove-cl' + ${classifie.classify_id}">删除</button>
                                                <!--<a href="#" th:id="'updata-cl' + ${classifie.classify_id}" class="cl-updata">修改</a>-->
                                                <!--<a href="#" th:id="'remove-cl' + ${classifie.classify_id}" class="cl-remove"> 删除</a>-->
                                            </td>
                                        </tr>
                                    </th:block>
                                </th:block>
                            </th:block>


                            </tbody>


                        </table>
                        </th:block>

                        <!--<div class="text-right">-->
                            <!--<button class="btn btn-primary" id="btn-sub" style="width: 82px;"><i class="fa fa-dollar"></i> 生成订单</button>-->
                        <!--</div>-->

                        <!-- 模态框（Modal） -->
                        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title" id="myModalLabel">
                                            添加/修改
                                        </h4>
                                    </div>
                                    <div class="modal-body">
                                        <div class="input-group input-group-lg">
                                            <span style="padding: 12px 12px;font-size: 1.25rem;font-weight: 400;
                                            line-height: 1;color: #555;text-align: center;background-color: #eee;
                                            border: 1px solid #ccc;border-radius: 4px;" id="sizing-addon1">添加/修改为</span>
                                            <input type="text" class="form-control" placeholder="名称" aria-describedby="sizing-addon1" name="-1">
                                        </div>

                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" id="to-close">关闭
                                        </button>
                                        <button type="button" class="btn btn-primary" id="to-pay">
                                            确定
                                        </button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>



                    </div>

                </div>
            </div><!-- /.container-fluid -->
        </div>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->


    <!-- 引入页脚footer-fragment -->
    <div th:replace="admin/footer::footer-fragment"></div>
</div>
<!-- jQuery -->
<script th:src="@{/admin/plugins/jquery/jquery.min.js}"></script>
<!-- jQuery UI 1.11.4 -->
<script th:src="@{/admin/plugins/jQueryUI/jquery-ui.min.js}"></script>
<!-- Bootstrap 4 -->
<script th:src="@{/admin/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
<!-- AdminLTE App -->
<script th:src="@{/admin/dist/js/adminlte.min.js}"></script>


         <!--<link href="~/Content/Tree1/css/style.css" rel="stylesheet" />-->
<script type="text/javascript">

    $('#to-close').click(function () {
        closeWin();
    });
    var closeWin = function(){
        //关闭模态框
        $('#myModal').modal('hide');
        $('#myModalLabel').text("添加/删除");
        $('#sizing-addon1').text("添加/删除");
        $(".form-control").val("");
        $(".form-control").attr("id","");
    }

    $('#to-pay').click(function () {

        var value = $(".form-control").val().toString();
        if (value == "" || value == " " || value == null)return;
        console.log(value);
        var id = $(".form-control").attr("id");
        var name = $(".form-control").attr("name");
        var ca_or_cl = Number(name);
        if (id == "add-ca") {
            var jsonObject = JSON.stringify({category : value });
            restApi("/role/api/addca" , jsonObject );
        } else if (id == "add-cl"){
            var jsonObject = JSON.stringify({classify : value });
            restApi("/role/api/addcl" , jsonObject );
        } else if (id == "upd-ca"){
            var jsonObject = JSON.stringify({category : value , id : ca_or_cl });
            restApi("/role/api/updca" , jsonObject );
        }else if (id == "upd-cl"){
            var jsonObject = JSON.stringify({classify : value , id : ca_or_cl });
            restApi("/role/api/updcl" , jsonObject );
        }

    });

    $('.btn-success').click(function () {
        addCa();
    });

    $('.btn-default').click(function(){

        btnThis($(this))

    });

    $('.btn-primary').click(function(){

        btnThis($(this))

    });

    var btn0 = 'add012-cl';
    var btn1 = 'updata-ca';
    var btn2 = 'remove-ca';
    var btn3 = 'updata-cl';
    var btn4 = 'remove-cl';
    var str = [btn0 ,btn1 ,btn2 ,btn3 ,btn4 ];

    var btnThis = function(btn){

        var id  = btn.attr('id').toString();
        var stat = id.substring(0,9);
        // console.log(stat);
       for ( i=0 ; i<str.length ; i++ )
       {
           if (stat === str[i]) {
               console.log(id.substring(9));
               if (i == 0 ){
                   addCl();
               }
               else if (i == 1){
                   updCa(id.substring(9));
               }
               else if (i == 2){
                   remCa(id.substring(9));
               }
               else if (i == 3){
                   updCl(id.substring(9));
               }
               else if (i == 4){
                   remCl(id.substring(9));
               }
           }
        }
    }
    //显示模态窗口
    var showModal = function (strLabel ,status) {

        $('#myModalLabel').text(strLabel);
        $('#sizing-addon1').text(strLabel);
        $(".form-control").attr("id",status);
        $('#myModal').modal('show');

    }

    var addCa = function () {
        showModal("添加一级分类" , "add-ca");
    }

    var addCl = function () {
        showModal("添加二级分类" ,"add-cl");
    }
    
    var updCa = function (id) {
        $(".form-control").attr("name",id);
        showModal("修改为" , "upd-ca");

    }
    var remCa = function (id) {
        // $('#myModal').modal('show');
        var jsonObject = JSON.stringify({id : Number(id) });
        restApi("/role/api/remca" , jsonObject );
    }
    var updCl = function (id) {
        $(".form-control").attr("name",id);
        showModal("修改为" , "upd-cl");
    }
    var remCl = function (id) {
        // $('#myModal').modal('show');
        var jsonObject = JSON.stringify({id : Number(id) });
        restApi("/role/api/remcl" , jsonObject );
    }


    var restApi = function (uri , jsonObject) {

        $.ajax(
            {
                type: "POST" ,
                url:uri,
                dataType: "JSON",
                contentType: "application/json",
                data:jsonObject,
                success:function(result){
                    if (result.resultCode == 200) {
                        closeWin();
                        alert(result.message);
                    }else {
                        closeWin();
                        alert(result.message);
                    }
                }
            });

    }










</script>

</body>
</html>
